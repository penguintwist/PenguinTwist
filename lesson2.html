<!DOCTYPE html>
<html lang="en-GB">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lesson 2: Variables - PenguinTwist</title>
    
    <!-- CodeMirror CSS -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/codemirror.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/theme/monokai.min.css">
    
    <!-- Shared Styles -->
    <link rel="stylesheet" href="shared/lesson-styles.css">
    
    <style>
        /* Updated Dark Mode Toggle Styles */
        .dark-mode-container {
            position: absolute;
            top: 25px;
            right: 25px;
            display: flex;
            align-items: center;
            background: rgba(255, 255, 255, 0.15);
            padding: 8px 12px;
            border-radius: 25px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            z-index: 2;
            cursor: pointer;
            transition: background 0.3s ease;
        }
        
        .dark-mode-container:hover {
            background: rgba(255, 255, 255, 0.2);
        }
        
        .dark-mode-label {
            color: white;
            font-size: 14px;
            font-weight: 500;
            user-select: none;
            text-shadow: 0 1px 2px rgba(0,0,0,0.2);
            cursor: pointer;
        }
        
        /* Hide the checkbox completely */
        #dark-mode-toggle {
            display: none;
        }
    </style>
</head>
<body>
    <div class="header">
        <div class="dark-mode-container" id="dark-mode-container">
            <input type="checkbox" id="dark-mode-toggle" style="display: none;">
            <label for="dark-mode-toggle" class="dark-mode-label" id="dark-mode-label">üåô Dark Mode</label>
        </div>
        <div class="container">
            <h1>Lesson 2: Variables</h1>
            <p>Give your programs memory - store and remember information</p>
        </div>
    </div>
    
    <div class="nav-back">
        <div class="container">
            <a href="navigation.html">‚Üê Back to All Lessons</a>
            <span style="color: #666;">Previous: <a href="lesson1.html" style="color: #667eea;">Hello World</a></span>
        </div>
    </div>
    
    <div class="container">
        <div class="lesson-content">
            <div class="section">
                <h3>Why Programs Need Memory</h3>
                <div class="intro">
                    <p>Imagine a calculator that forgets your answer the moment you press equals. Or a game that resets your score every time you collect a coin. Or a website that asks for your name on every single page.</p>
                    <p>Programs need to remember information to be useful. Variables are like labelled storage boxes in the computer's memory - they let your programs remember and reuse information like names, scores, messages, or any data your program needs.</p>
                </div>
            </div>
            
            <div class="section">
                <h3>Understanding Variables as Memory Boxes</h3>
                <div class="theory">
                    <p>Think of variables as labeled boxes in a warehouse. Each box has:</p>
                    <p>‚Ä¢ A <strong>name</strong> (the label on the box)</p>
                    <p>‚Ä¢ A <strong>value</strong> (what's stored inside the box)</p>
                    <p>‚Ä¢ A <strong>location</strong> (where Python can find it in memory)</p>
                    
                    <div class="tip">
                        <strong>Memory Box Metaphor:</strong> When you create a variable called "name", Python creates a box labeled "name" and puts your value inside it. Whenever you use that variable name later, Python opens the box and looks at what's inside.
                    </div>
                </div>
                
                <!-- Memory Visualization Component -->
                <div id="memoryBoxDemo"></div>
            </div>
            
            <div class="section">
                <h3>How Variable Assignment Works</h3>
                <div class="theory">
                    <p>Understanding the step-by-step process helps you see exactly what happens when you create a variable:</p>
                </div>
                
                <!-- Assignment Demo Component -->
                <div id="assignmentDemo"></div>
            </div>
            
            <div class="section">
                <h3>Creating Your First Variable</h3>
                <div class="theory">
                    <p>In Python, you create a variable using the assignment operator (the equals sign). This tells Python to store information in a labelled box.</p>
                    
                    <div class="code-example">name = "Alex"</div>
                    
                    <p>This code creates a memory box labelled 'name' and stores the text "Alex" inside it.</p>
                    
                    <div class="tip">
                        <strong>The Assignment Process:</strong> The equals sign doesn't mean "equal to" in maths. In programming, it means "store the value on the right into the variable on the left."
                    </div>
                    
                    <p>You can store different types of information:</p>
                    <div class="code-example">name = "Alex"
age = 15</div>
                    
                    <div class="tip">
                        <strong>Important:</strong> Text must be wrapped in quotes, but numbers don't need quotes. Python treats them differently!
                    </div>
                </div>
            </div>
            
            <div class="section">
                <h3>Storage and Retrieval Process</h3>
                
                <!-- Visual Metaphor Component -->
                <div id="storageFlow"></div>
            </div>
            
            <div class="section">
                <h3>Try It Yourself</h3>
                <div id="variablePracticePlayground"></div>
            </div>
            
            <div class="section">
                <h3>Using Variables with Print</h3>
                <div class="theory">
                    <p>Now that you can create variables, you can use them with print statements. This is where the magic happens - your program can remember and display information!</p>
                    
                    <div class="code-example">name = "Alex"
print(name)</div>
                    
                    <div class="expected-output"><strong>Output:</strong>
Alex</div>
                    
                    <div class="tip">
                        <strong>Key Distinction:</strong> Notice the difference between print(name) and print("name"). The first prints the contents of the variable, the second prints the word "name".
                    </div>
                    
                    <p>Watch what happens when we print both variables:</p>
                    <div class="code-example">name = "Alex"
age = 15
print(name)
print(age)</div>
                    
                    <div class="expected-output"><strong>Output:</strong>
Alex
15</div>
                </div>
            </div>
            
            <div class="section">
                <h3>Practice with Variables and Print</h3>
                <div id="variablePrintPlayground"></div>
                
                <div class="tip">
                    <strong>Try these experiments:</strong>
                    <br>‚Ä¢ Change "Alex" to your own name
                    <br>‚Ä¢ Add a new variable for your favorite subject
                    <br>‚Ä¢ Try storing a number without quotes
                    <br>‚Ä¢ What happens if you forget the quotes around text?
                </div>
            </div>
            
            <div id="masteryCheck"></div>
            <div id="challengeSystem" class="challenge-system-hidden"></div>
        </div>
    </div>
    
    <div class="container">
        <div class="lesson-navigation">
            <div class="nav-buttons">
                <a href="lesson1.html" class="nav-btn">‚Üê Previous Lesson</a>
                <a href="navigation.html" class="nav-btn">üìö All Lessons</a>
                <a href="lesson3.html" class="nav-btn disabled" id="nextLessonBtn">Next Lesson ‚Üí</a>
            </div>
        </div>
    </div>
    
    <!-- CodeMirror JavaScript -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/codemirror.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/mode/python/python.min.js"></script>
    
    <!-- Shared Components -->
    <script src="shared/python-interpreter.js"></script>
    <script src="shared/lesson-components.js"></script>
    
    <script>
        // Challenge data with reliable validation
        var challenges = {
            basic: [
                {
                    title: "Create Your Profile",
                    description: "Create variables for your name, age, and favorite color. Then print all three.",
                    starter: "# Create three variables:\n# name = \"Your Name\"\n# age = 15\n# color = \"blue\"\n\n# Print them:\n# print(name)\n# print(age)\n# print(color)",
                    test: function(code) {
                        var assignments = (code.match(/\w+\s*=\s*[^=\r\n]+/g) || []).length;
                        var prints = (code.match(/print\s*\(/g) || []).length;
                        return {
                            passed: assignments >= 3 && prints >= 3,
                            message: assignments >= 3 && prints >= 3 ? 
                                "Perfect! You created variables and printed them." :
                                "Create 3 variables and print each one."
                        };
                    }
                }
            ],
            creative: [
                {
                    title: "Character Creator",
                    description: "Create a character with a name, superpower, and hometown.",
                    starter: "# Create your character:\n# hero_name = \"Lightning Bolt\"\n# power = \"Super Speed\"\n# city = \"Metro City\"\n\n# Print character profile:",
                    test: function(code) {
                        var hasVariables = (code.match(/\w+\s*=\s*[^=\r\n]+/g) || []).length >= 3;
                        var hasPrints = (code.match(/print\s*\(/g) || []).length >= 3;
                        return {
                            passed: hasVariables && hasPrints,
                            message: hasVariables && hasPrints ? 
                                "Amazing character! Your superhero is ready." :
                                "Create 3 character variables and print them."
                        };
                    }
                }
            ],
            advanced: [
                {
                    title: "Mixed Data Types",
                    description: "Create variables with both text (in quotes) and numbers (no quotes).",
                    starter: "# Text variables (use quotes):\n# name = \"Alex\"\n\n# Number variables (no quotes):\n# age = 15\n\n# Print both types:",
                    test: function(code) {
                        var hasQuoted = /"[^"]*"/.test(code) || /'[^']*'/.test(code);
                        var hasNumber = /=\s*\d+/.test(code);
                        var hasPrints = (code.match(/print\s*\(/g) || []).length >= 2;
                        return {
                            passed: hasQuoted && hasNumber && hasPrints,
                            message: hasQuoted && hasNumber && hasPrints ? 
                                "Excellent! You used both text and numbers." :
                                "Use both quoted text and numbers, then print them."
                        };
                    }
                }
            ]
        };

        // Updated dark mode functionality
        function setupDarkMode() {
            var container = document.getElementById('dark-mode-container');
            var toggle = document.getElementById('dark-mode-toggle');
            var label = document.getElementById('dark-mode-label');
            
            if (!container || !toggle || !label) return;
            
            // Load saved preference
            var isDark = localStorage.getItem('darkMode') === 'true';
            if (isDark) {
                document.body.classList.add('dark-mode');
                toggle.checked = true;
                label.textContent = '‚òÄÔ∏è Light Mode';
            }
            
            // Click handler for the entire container
            container.addEventListener('click', function(e) {
                e.preventDefault();
                toggle.checked = !toggle.checked;
                
                try {
                    if (toggle.checked) {
                        document.body.classList.add('dark-mode');
                        localStorage.setItem('darkMode', 'true');
                        label.textContent = '‚òÄÔ∏è Light Mode';
                    } else {
                        document.body.classList.remove('dark-mode');
                        localStorage.setItem('darkMode', 'false');
                        label.textContent = 'üåô Dark Mode';
                    }
                    
                    // Notify other components
                    var event = document.createEvent('CustomEvent');
                    event.initEvent('themeChanged', true, true);
                    document.dispatchEvent(event);
                } catch (e) {
                    console.warn('Could not save dark mode preference:', e);
                }
            });
        }

        // ES5 compatible initialization following technical integration spec
        document.addEventListener('DOMContentLoaded', function() {
            setTimeout(function() {
                try {
                    // Check if components exist
                    if (!window.PenguinTwistComponents || !window.PenguinTwistInterpreter) {
                        console.log('Components not loaded, using fallbacks');
                        setupBasicFallbacks();
                        return;
                    }

                    // Initialize dark mode
                    window.PenguinTwistComponents.setupDarkMode();

                    // Create memory visualization
                    var memoryDemo = window.PenguinTwistComponents.createMemoryVisualization(
                        'memoryBoxDemo',
                        {
                            title: 'Think of Variables as Memory Boxes',
                            boxes: [
                                { label: 'name', value: 'Empty' },
                                { label: 'age', value: 'Empty' },
                                { label: 'pet', value: 'Empty' }
                            ],
                            showButton: true
                        }
                    );
                    memoryDemo.init();

                    // Create assignment demo
                    var assignmentDemo = window.PenguinTwistComponents.createAssignmentDemo('assignmentDemo');
                    assignmentDemo.init();

                    // Create storage flow visual metaphor
                    var storageFlow = window.PenguinTwistComponents.createVisualMetaphor(
                        'storageFlow', 
                        'storage_boxes',
                        {
                            variableName: 'name',
                            variableValue: 'Alex'
                        }
                    );
                    storageFlow.init();

                    // Create playgrounds using IDE-style design
                    var playground1 = window.PenguinTwistInterpreter.createPlayground(
                        'variablePracticePlayground',
                        'variables',
                        {
                            title: 'Variable Creation Practice',
                            defaultCode: 'name = "Alex"\nage = 15',
                            showMemory: true
                        }
                    );
                    playground1.init();

                    var playground2 = window.PenguinTwistInterpreter.createPlayground(
                        'variablePrintPlayground',
                        'variables',
                        {
                            title: 'Variables and Print Practice',
                            defaultCode: 'name = "Alex"\nage = 15\nprint(name)\nprint(age)',
                            showMemory: true
                        }
                    );
                    playground2.init();

                    // Create mastery check
                    var masteryCheck = window.PenguinTwistComponents.createMasteryCheck(
                        'masteryCheck',
                        [
                            {
                                question: 'To store "Computer Science" in a variable called subject, what code do you write?',
                                placeholder: 'Type your answer here',
                                validateAnswer: function(answer) {
                                    return /subject\s*=\s*["']computer science["']/i.test(answer.trim());
                                },
                                hint: 'Remember: subject = "Computer Science"'
                            },
                            {
                                question: 'Create a variable called "hobby" that stores your favorite hobby.',
                                placeholder: 'Type your code here',
                                validateAnswer: function(answer) {
                                    return /hobby\s*=\s*["'][^"']+["']/i.test(answer.trim());
                                },
                                hint: 'Use: hobby = "your hobby here"'
                            },
                            {
                                question: 'If you run: name = "Jamie" then print(name), what appears on screen?',
                                placeholder: 'What gets displayed?',
                                validateAnswer: function(answer) {
                                    return answer.toLowerCase().includes('jamie');
                                },
                                hint: 'The output would be: Jamie'
                            }
                        ],
                        {
                            title: 'Check Your Understanding',
                            onComplete: function() {
                                unlockNextLesson();
                                showChallenges();
                            }
                        }
                    );
                    masteryCheck.init();

                    // Create challenge system
                    var challengeSystem = window.PenguinTwistComponents.createChallengeSystem(
                        'challengeSystem',
                        challenges,
                        {
                            title: 'Practice Challenges'
                        }
                    );
                    challengeSystem.init();

                } catch (error) {
                    console.log('Component initialization failed:', error);
                    setupBasicFallbacks();
                }
            }, 100);
        });

        function unlockNextLesson() {
            var nextBtn = document.getElementById('nextLessonBtn');
            if (nextBtn) {
                nextBtn.classList.remove('disabled');
                nextBtn.style.opacity = '1';
                nextBtn.style.pointerEvents = 'auto';
            }
        }

        function showChallenges() {
            var challengeDiv = document.getElementById('challengeSystem');
            if (challengeDiv) {
                challengeDiv.classList.remove('challenge-system-hidden');
                challengeDiv.classList.add('unlocked');
                challengeDiv.scrollIntoView({ behavior: 'smooth' });
            }
        }

        function setupBasicFallbacks() {
            var containers = ['memoryBoxDemo', 'assignmentDemo', 'storageFlow',
                             'variablePracticePlayground', 'variablePrintPlayground', 
                             'masteryCheck', 'challengeSystem'];
            
            for (var i = 0; i < containers.length; i++) {
                var element = document.getElementById(containers[i]);
                if (element) {
                    element.innerHTML = '<div class="fallback-message">' +
                        '<p>Interactive component loading...</p>' +
                        '<p>Please refresh if this message persists.</p>' +
                        '</div>';
                }
            }
        }
    </script>
</body>
</html>
