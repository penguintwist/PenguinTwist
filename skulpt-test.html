<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Skulpt Loading Test - Multiple CDNs</title>
</head>
<body>
    <h1>Skulpt Loading Test - Multiple CDNs</h1>
    <div id="status">Testing CDN sources...</div>
    <div id="output"></div>
    
    <script>
        var cdnSources = [
            {
                name: 'CDNJS',
                skulpt: 'https://cdnjs.cloudflare.com/ajax/libs/skulpt/0.11.1/skulpt.min.js',
                stdlib: 'https://cdnjs.cloudflare.com/ajax/libs/skulpt/0.11.1/skulpt-stdlib.js'
            },
            {
                name: 'UNPKG',
                skulpt: 'https://unpkg.com/skulpt@0.11.1/dist/skulpt.min.js',
                stdlib: 'https://unpkg.com/skulpt@0.11.1/dist/skulpt-stdlib.js'
            },
            {
                name: 'JSDelivr',
                skulpt: 'https://cdn.jsdelivr.net/npm/skulpt@0.11.1/dist/skulpt.min.js',
                stdlib: 'https://cdn.jsdelivr.net/npm/skulpt@0.11.1/dist/skulpt-stdlib.js'
            }
        ];
        
        var currentCDN = 0;
        
        function tryNextCDN() {
            if (currentCDN >= cdnSources.length) {
                document.getElementById('status').innerHTML += '<br>‚ùå All CDN sources failed - Skulpt cannot be loaded';
                return;
            }
            
            var cdn = cdnSources[currentCDN];
            document.getElementById('status').innerHTML += '<br>üîÑ Trying ' + cdn.name + '...';
            
            var script1 = document.createElement('script');
            script1.src = cdn.skulpt;
            
            script1.onload = function() {
                document.getElementById('status').innerHTML += '<br>‚úÖ ' + cdn.name + ' Skulpt core loaded';
                
                // Load stdlib
                var script2 = document.createElement('script');
                script2.src = cdn.stdlib;
                script2.onload = function() {
                    document.getElementById('status').innerHTML += '<br>‚úÖ ' + cdn.name + ' Skulpt stdlib loaded';
                    testSkulpt();
                };
                script2.onerror = function(e) {
                    document.getElementById('status').innerHTML += '<br>‚ùå ' + cdn.name + ' stdlib failed';
                    currentCDN++;
                    tryNextCDN();
                };
                document.head.appendChild(script2);
            };
            
            script1.onerror = function(e) {
                document.getElementById('status').innerHTML += '<br>‚ùå ' + cdn.name + ' core failed';
                currentCDN++;
                tryNextCDN();
            };
            
            document.head.appendChild(script1);
        }
        
        // Start testing
        tryNextCDN();
        
        function testSkulpt() {
            try {
                if (window.Sk) {
                    document.getElementById('status').innerHTML += '<br>‚úÖ Skulpt object exists';
                    
                    // Test basic execution
                    Sk.configure({
                        output: function(text) {
                            document.getElementById('output').innerHTML += text;
                        }
                    });
                    
                    var prog = 'print("Hello from Skulpt!")';
                    var myPromise = Sk.misceval.asyncToPromise(function() {
                        return Sk.importMainWithBody("<stdin>", false, prog, true);
                    });
                    
                    myPromise.then(function() {
                        document.getElementById('status').innerHTML += '<br>üéâ SUCCESS! Skulpt is working perfectly!';
                    }).catch(function(err) {
                        document.getElementById('status').innerHTML += '<br>‚ùå Skulpt execution failed: ' + err;
                    });
                } else {
                    document.getElementById('status').innerHTML += '<br>‚ùå Skulpt object not found after loading';
                }
            } catch (error) {
                document.getElementById('status').innerHTML += '<br>‚ùå Skulpt test error: ' + error;
            }
        }
        
        // Also test direct URL access
        document.getElementById('status').innerHTML += '<br><br>üîó Test these URLs directly in your browser:';
        cdnSources.forEach(function(cdn) {
            document.getElementById('status').innerHTML += '<br><a href="' + cdn.skulpt + '" target="_blank">' + cdn.name + ' Skulpt</a>';
            document.getElementById('status').innerHTML += ' | <a href="' + cdn.stdlib + '" target="_blank">' + cdn.name + ' Stdlib</a>';
        });
    </script>
</body>
</html>
